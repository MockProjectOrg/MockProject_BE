<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>
        Dashboard Overview
    </title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>

    <style>
        @media (max-width: 768px) {
    iframe {
            height: 400px;
        width: 100%;
    }
}
    </style>
</head>
<body class="bg-gray-100 font-sans leading-normal tracking-normal">
<div class="flex">
    <!-- Sidebar -->
    <div class="w-64 bg-gray-900 h-screen">
        <div class="p-4 text-white text-2xl font-bold">
            dashlite
        </div>
        <nav class="mt-10">
            <a class="block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700 text-white" href="#">
                <i class="fas fa-tachometer-alt mr-3">
                </i>
                Dashboard
            </a>
            <a class="block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700 text-white" href="#">
                <i class="fas fa-book mr-3">
                </i>
                Bookings
            </a>
            <a class="block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700 text-white" href="#">
                <i class="fas fa-bed mr-3">
                </i>
                Room
            </a>

        </nav>
        <div class="mt-10 px-4">
            <a class="block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white" href="#">
                <i class="fas fa-arrow-left mr-3">
                </i>
                Main Dashboard
            </a>
            <a class="block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white" href="#">
                <i class="fas fa-th-large mr-3">
                </i>
                All Components
            </a>
        </div>
    </div>
    <!-- Main Content -->
    <div class="flex-1 p-6">
        <!-- Top Bar -->
        <div class="flex justify-between items-center mb-6">

            <div class="flex items-center">
                <div class="mr-4">
                    <img alt="Flag" class="rounded-full" height="30"
                         src="https://storage.googleapis.com/a1aa/image/0Ff5SQhxkCrEGj3lf3K94qcQC1s_NjHEALDnF69PZKE.jpg"
                         width="30"/>
                </div>
                <div class="flex items-center">
                    <img alt="User Avatar" class="rounded-full mr-2" height="30"
                         src="https://storage.googleapis.com/a1aa/image/YDBCQH_TqS7OJDXBh6B_E_XomAnNTc7E41JSmqk-8GQ.jpg"
                         width="30"/>
                    <div>
                        <div class="text-sm font-semibold">
                            HIEU
                        </div>
                        <div class="text-xs text-gray-500">
                            Administrator
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Dashboard Overview -->
        <div class="text-2xl font-semibold mb-4">
            Dashboard Overview
        </div>
        <div class="text-gray-500 mb-6">
            Welcome to ADMIN Dashboard Template.
        </div>
        <!-- Stats -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="text-gray-500">
                    Total Orders
                </div>
                <div class="text-3xl font-bold">
                    <span th:text="${totalOrders}"></span>
                </div>
                <div class="flex justify-between mt-4">
                    <div>
                        <div class="text-gray-500">
                            THIS MONTH
                        </div>
                        <div class="text-xl font-bold">
                            <span th:text="${thisMonthlyOrders}"></span>
                        </div>
                    </div>
                    <div>
                        <div class="text-gray-500">
                            THIS WEEK
                        </div>
                        <div class="text-xl font-bold">
                            <span th:text="${thisWeekOrders}"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="text-gray-500">
                    Total Bookings
                </div>
                <div class="text-3xl font-bold">
                    <span th:text="${totalRevenues}"></span>
                    <span class="text-red-500 text-sm" th:if="${percentageChange < 0}">
                        ↓ <span th:text="${#numbers.formatDecimal(percentageChange, 1, 2)}">0.00</span>%
                    </span>
                    <span class="text-green-500 text-sm" th:if="${percentageChange > 0}">
                        ↑ <span th:text="${#numbers.formatDecimal(percentageChange, 1, 2)}">0.00</span>%
                    </span>
                </div>
                <div class="flex justify-between mt-4">
                    <div>
                        <div class="text-gray-500">
                            PREVIOUS MONTH
                        </div>
                        <div class="text-xl font-bold">
                            <span th:text="${previousRevenue}"></span>
                        </div>
                    </div>
                    <div>
                        <div class="text-gray-500">
                            THIS MONTH
                        </div>
                        <div class="text-xl font-bold">
                            <span th:text="${monthlyRevenue}"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="text-gray-500">
                    Rooms Available
                </div>
                <div class="text-3xl font-bold">
                    <span th:text="${countRoomAvailable}"></span>
                </div>
                <div class="flex justify-between mt-4">
                    <div>
                        <div class="text-gray-500">
                            BOOKED (W)
                        </div>
                        <div class="text-xl font-bold">
                            <span th:text="${bookedRoomsWeekly}"></span>
                        </div>
                    </div>
                    <div>
                        <div class="text-gray-500">
                            BOOKED (M)
                        </div>
                        <div class="text-xl font-bold">
                            <span th:text="${bookedRoomsMonthly}"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Charts and Graphs -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <!-- Top Selected Package -->
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="flex justify-between items-center mb-4">
                    <div class="text-gray-500">Top Selected Package</div>
                    <div class="text-gray-500">30 Days</div>
                </div>
                <div class="space-y-2">
                    <th:block th:each="package : ${topPackages}">
                        <div class="flex justify-between items-center">
                            <div class="text-gray-500" th:text="${package['packageName']}"></div>
                            <div class="text-gray-500"
                                 th:text="${#numbers.formatDecimal(package['percentage'], 1, 2)} + '%'"></div>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div class="h-2.5 rounded-full"
                                 th:style="'width:' + ${package['percentage']} + '%; background-color:' + ${package['color']}"></div>
                        </div>
                    </th:block>
                </div>
            </div>

            <!-- Sales Revenue -->
            <div class="bg-white p-6 rounded shadow">
                <div class="flex justify-between items-center mb-4">
                    <div class="text-gray-500">Popular Room Types</div>
                    <div class="text-gray-500">Last 12 Months</div>
                </div>
                <canvas id="popularRoomChart"></canvas>
            </div>
        </div>
        <!-- Room Booking Chart and Income vs Expenses -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="flex justify-between items-center mb-4">
                    <div class="text-gray-500">
                        Room Booking Chart
                    </div>
                    <div class="text-gray-500">
                        30 Days
                    </div>
                </div>
                <canvas id="bookingChart"></canvas>
            </div>
        </div>
        <!-- New Customer and Recent Activities -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="flex justify-between items-center mb-4">
                    <div class="text-gray-500">
                        New Customer
                    </div>
                    <div class="text-blue-500">
                        <a href="/user">View All</a>
                    </div>
                </div>
                <div class="space-y-4">
                    <div class="flex items-center" th:each="customer : ${newCustomers}">
                        <img alt="Customer Avatar" class="rounded-full mr-4" height="40"
                             th:src="${customer.avatarUrl}" width="40"/>
                        <div>
                            <div class="text-gray-700 font-semibold" th:text="${customer.name}"></div>
                            <div class="text-gray-500 text-sm" th:text="${customer.email}"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="flex justify-between items-center mb-4">
                    <div class="text-gray-500">Recent Activities</div>
                    <div class="text-blue-500 cursor-pointer hover:underline">Cancel All</div>
                </div>
                <div class="space-y-4" th:if="${not #lists.isEmpty(recentActivities)}">
                    <th:block th:each="activity : ${recentActivities}">
                        <div class="flex items-center gap-4">
                            <img alt="Activity Avatar" class="rounded-full" height="40"
                                 th:src="${activity.avatarUrl} ?: 'default-avatar.png'"
                                 width="40"/>
                            <div>
                                <div class="text-gray-700 font-semibold w-32 truncate"
                                     th:text="${activity.username}"></div>
                                <div class="text-gray-500 text-sm" th:text="${activity.action}"></div>
                                <div class="text-gray-400 text-xs" th:text="${activity.timestamp}"></div>
                            </div>
                        </div>
                    </th:block>
                </div>
                <div class="text-gray-400 text-sm text-center" th:if="${#lists.isEmpty(recentActivities)}">
                    No recent activities.
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="mt-6 text-center text-gray-500 text-sm">
            © 2024 DashLite. Template by Softnio
        </div>
    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
    console.log("🚀 Khởi tạo biểu đồ...");

    // 📊 Biểu đồ đặt phòng
    const bookingCanvas = document.getElementById('bookingChart');
    if (!bookingCanvas) {
        console.error("⚠️ Không tìm thấy phần tử #bookingChart!");
        return;
    }
    const bookingCtx = bookingCanvas.getContext('2d');

    let bookingChart = new Chart(bookingCtx, {
        type: 'bar',
        data: {
            labels: /*[[${labels}]]*/ [],
            datasets: [{
                label: 'Số lượng đặt phòng',
                data: /*[[${bookingData}]]*/ [],
                backgroundColor: 'rgba(54, 162, 235, 0.5)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: { y: { beginAtZero: true } }
        }
    });

    // 📊 Biểu đồ loại phòng phổ biến
    const popularRoomCanvas = document.getElementById('popularRoomChart');
    if (!popularRoomCanvas) {
        console.error("⚠️ Không tìm thấy phần tử #popularRoomChart!");
        return;
    }
    const popularRoomCtx = popularRoomCanvas.getContext('2d');

    let popularRoomChart = new Chart(popularRoomCtx, {
        type: 'pie',
        data: {
            labels: /*[[${roomTypes}]]*/ [],
            datasets: [{
                label: 'Loại phòng phổ biến',
                data: /*[[${bookingCounts}]]*/ [],
                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'],
                borderColor: '#ffffff',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
});

</script>
</body>
</html>
