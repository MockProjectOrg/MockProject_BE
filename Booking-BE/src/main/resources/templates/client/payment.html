<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>Project</title>
    <base href="/">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/x-icon" href="favicon.ico">


    <!-- Thêm thư viện Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
            integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
            crossorigin="anonymous"></script>


    <!-- Thêm thư viện jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Thêm thư viện Slick Slider -->
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.css">
    <link rel="stylesheet" type="text/css"
          href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.css">
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css"
          integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>

    <!-- Thêm thư viện AOS -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>


    <style>
        .container {
            width: 1180px;
            height: auto;
            margin: 100px auto;
            display: flex;
            justify-content: space-between;
        }

        .wrap-form {
            width: 65%;
            height: auto;
            display:flex ;
            flex-direction: column;
        }

        .form-info {
            width: 100%;
            height: auto;
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .wrap-form-price{
            border-bottom: 1px solid gray;
            margin-bottom: 15px;
        }

        .btn-book{
            width: 100%;
            padding: 10px 20px;
            color: white;
            background-color: orangered;
            border: none;
            border-radius: 5px;
            margin-top: 15px;
            transition: all .3s;
        }

        .btn-book:hover{
            background-color: #bc5b3b;
        }

        .room-info {
            width: 33%;
            height: 700px;
            background-color: white;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .room-info img{
            width: 100%;
            height: 250px; /* Đặt chiều cao cố định */
            object-fit: cover;
        }

        .wrap-booking-room{
            padding: 10px;
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 50px;
            border-bottom: 2px solid #deb887;
            position: fixed;
            top: 0;
            width: 100%;
            background-color: white;
            z-index: 1;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #222;
        }

        .logo span {
            color: #deb887;
        }

        .nav-links {
            list-style: none;
            display: flex;
        }

        .nav-links li {
            margin: 0 15px;
        }

        .nav-links a {
            text-decoration: none;
            color: #222;
            font-size: 18px;
            position: relative;
        }

        .nav-links a:hover::after,
        .nav-links a.active::after {
            content: "";
            display: block;
            width: 100%;
            height: 2px;
            background-color: #deb887;
            position: absolute;
            bottom: -5px;
            left: 0;
        }

        .avt_func{
            width: 78px;
            height: 50px;
            cursor: pointer;
        }

        .avt_func div img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
        }

        .wrap-drop-personal {
            display: none;
            position: absolute;
            cursor: pointer;
            top: 82%;
            left: 87%;
            background-color: white;
            box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
            z-index: 1;
            width: 200px;
        }

        .wrap-drop-personal a {
            color: black;
            border-left: 4px solid white;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        .wrap-drop-personal a:hover {
            background-color: #F7F7F7;
            border-left: 4px solid #F48023;
            color: #F48023;
        }

        .wrap-drop-personal a i{
            padding-right: 10px;
        }

        .wrap-drop-personal a:hover i {
            color: #F48023;
        }

        .avt_func:hover .wrap-drop-personal {
            display: block;
        }

        .capacity{
            width: 100%;
            height: auto;
            display: flex;

        }

        .fix-padding{
            padding-right: 10px;
        }

        .utilities i{
            padding-right: 10px;
        }

        .footer-link {
            text-decoration: none;
            color: #f8f9fa;
            transition: color 0.3s;
        }
        .footer-link:hover {
            color: #0d6efd;
        }

    </style>
</head>

<body style="background-color: rgb(247, 249, 250)">
<nav class="navbar">
    <div class="logo">Sona<span>.</span></div>
    <ul class="nav-links">
        <li><a th:href="@{/home}" class="active">Home</a></li>
        <li><a href="#">Rooms</a></li>
        <li><a href="#">About Us</a></li>
        <li><a href="#">Pages</a></li>
        <li><a href="#">News</a></li>
        <li><a href="#">Contact</a></li>
    </ul>
    <div class="avt_func" th:object="${room}">
        <div class="d-flex align-items-center">
            <img src="https://firebasestorage.googleapis.com/v0/b/photo-archive-a0523i1.appspot.com/o/imgLanding%2Fz5572534439426_12e9a1d7d2b51721634af3d654e8c21b.jpg?alt=media&token=6fa5eb7d-4293-4552-b680-c8951492269d"
                 alt="Avatar">
            <i style="margin-left: 15px" class="fa-solid fa-caret-down"></i>
        </div>
        <div class="wrap-drop-personal">
            <a th:href="@{/api/user/userProfile}"><i class="fa-regular fa-user"></i> Profile</a>
            <a th:href="@{/logout}"><i class="fa-regular fa-user"></i> Logout</a>

        </div>
    </div>
</nav>
<div class="container">
    <form class="wrap-form" id="paymentForm" method="post" action="/api/pay" th:object="${bill}">
<!--        <input type="hidden" name="roomId" th:field="*{roomId}" th:value="${room.get().getId()}">-->
        <div class="form-info">
            <h2>Contact Information</h2>
            <p>Please fill in all information correctly to ensure you receive your Booking Confirmation (E-voucher) via your email.</p>
            <div class="row g-3 needs-validation" novalidate>
                <div class="col-md-4">
                    <label for="validationCustom01" class="form-label">First Name</label>
                    <input type="text" class="form-control" id="validationCustom01" name="firstName"  th:field="*{firstName}" required>
                    <div class="valid-feedback">
                        Looks good!
                    </div>
                </div>
                <div class="col-md-8">
                    <label for="validationCustom02" class="form-label">Last Name</label>
                    <input type="text" class="form-control" id="validationCustom02" name="lastName" th:field="*{lastName}"  value="Otto" required>
                    <div class="valid-feedback">
                        Looks good!
                    </div>
                </div>

                <div class="col-md-6">
                    <label for="validationCustom03" class="form-label">Phone</label>
                    <input type="text" class="form-control" id="validationCustom03" name="phone" th:field="*{phone}"   required>
                    <div class="invalid-feedback">
                        Please provide a valid city.
                    </div>
                </div>
                <div class="col-md-6">
                    <label for="validationCustomUsername" class="form-label">Email</label>
                    <div class="input-group has-validation">
                        <input type="text" class="form-control" id="validationCustomUsername"
                               aria-describedby="inputGroupPrepend" th:field="*{email}" name="email"  required>
                        <div class="invalid-feedback">
                            Please choose a username.
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <label for="validationCustom04" class="form-label">Address</label>
                    <div class="input-group has-validation">

                        <input type="text" class="form-control" id="validationCustom04"
                               aria-describedby="inputGroupPrepend" name="address" th:field="*{address}"   required>
                        <div class="invalid-feedback">
                            Please choose a username.
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <label for="validationCustom04" class="form-label">Discount</label>
                    <div class="input-group has-validation">
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#discountModal">
                            Select Discount
                        </button>
                        <div class="invalid-feedback">
                            Please choose a username.
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div class="form-info">
            <p style="font-size: x-large"><b>Price Details</b></p>
            <div class="wrap-form-price">
                <p style="font-size: larger ">Room price:</p>
                <div class="d-flex justify-content-between">
                    <p th:text="${room.get().getRoomName()} + ' (' + ${day} + ' nights)'">Deluxe King - Ro (2 đêm)</p>
                    <p style="font-size: large" th:text="${#numbers.formatDecimal(totalPrice, 0, 'COMMA', 0, 'POINT') + ' VND'}">200000 VND</p>
                </div>
                <div class="d-flex justify-content-between">
                    <p style="font-size: larger">Discount</p>
                    <p style="font-size: large" id="discountValueDisplay"></p>
                </div>
            </div>

            <div class="d-flex justify-content-between">
                <h4><b>Total</b></h4>
                <input type="hidden" name="price" id="updatedTotalPrice" th:value="${totalPrice}" >
                <h2 id="totalPriceDisplay" th:data-original-price="${totalPrice}" style="color: orangered" th:text="${#numbers.formatDecimal(totalPrice, 0, 'COMMA', 0, 'POINT') + ' VND'}" ></h2>
            </div>


                <button class="btn-book" type="submit">Continue Payment</button>
        </div>


    </form>

    <div class="room-info" >
        <div style="padding: 10px">
            <b><p>Orchide'es Ocean Hotel</p></b>
        </div>
        <div class="slide">
            <img th:each="img :${images}"  th:src="${img.imageName}">
        </div>

        <div class="wrap-booking-room">
            <div class="d-flex justify-content-between">
                <div>
                    <p>Check In</p>
                </div>
                <div>
                    <input type="hidden" id="checkInHidden" name="checkIn" th:value="${checkIn}">
                    <b><p style="margin: 0" th:text="${dateCheckIn}"></p></b>
                    <p th:text="${timeCheckIn}"></p>
                </div>
            </div>

            <div class="d-flex justify-content-between" style="margin-bottom: 10px">
                <div>
                    <p>Check Out</p>
                </div>
                <div>
                    <input type="hidden" id="checkOutHidden" name="checkOut" th:value="${checkOut}">
                    <b><p style="margin: 0" th:text="${dateCheckOut}"></p></b>
                    <p th:text="${timeCheckOut}"></p>
                </div>
            </div>
            <div>
                <div>
                    <h5><b>Deluxe Double City View - Ro</b></h5>
                </div>
                <div class="capacity">
                    <div class="fix-padding">
                        <i class="fa-solid fa-people-roof"></i>
                    </div>
                    <div>
                        <p th:text="${room.get().getRoomType().getCapacity()} + ' Guest'"></p>
                    </div>
                </div>
                <div class="capacity">
                    <div class="fix-padding">
                        <i class="fa-solid fa-utensils"></i>
                    </div>
                    <div>
                        <p>Breakfast Included</p>
                    </div>
                </div>
                <div class="capacity">
                    <div class="utilities">
                        <i class="fa-solid fa-wifi"></i>
                        <i class="fa-solid fa-person-swimming"></i>
                        <i class="fa-solid fa-bottle-water"></i>
                    </div>
                </div>
            </div>
            <div class="d-flex justify-content-between" style="padding-top: 10px">
                <div >
                    <b><p><i class="fa-solid fa-file-invoice"></i> Total room price: </p></b>
                    <p>1 phòng, 1 đêm</p>
                </div>
                <b><h5 th:text="${#numbers.formatDecimal(totalPrice, 0, 'COMMA', 0, 'POINT') + ' VND'}"></h5></b>
            </div>

        </div>
    </div>

</div>

<div class="modal fade" id="discountModal" tabindex="-1" aria-labelledby="discountModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="discountModalLabel">Select a Discount</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="discountForm">
                    <div class="list-group">
                        <div th:each="discount : ${discounts}" class="list-group-item list-group-item-action">
                            <input type="radio" class="form-check-input me-2" name="selectedDiscount"
                                   th:id="'discount_' + ${discount.getId()}" th:value="${discount.getId()}">
                            <label th:for="'discount_' + ${discount.getId()}" class="form-check-label">
                                <strong th:text="${discount.getName()}"></strong> -
                                <span class="text-success fw-bold" th:text="${discount.getDiscountValue() + '% Off'}"></span>
                                <br>
                                <small class="text-muted">Expires on: <span th:text="${#temporals.format(discount.getExpiredAt(), 'dd/MM/yyyy')}"></span></small>
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="applyDiscount()">Apply Discount</button>
            </div>
        </div>
    </div>
</div>
<footer class="bg-dark text-white pt-5 pb-4">
    <div class="container">
        <div class="row">
            <!-- Thông tin khách sạn -->
            <div class="col-md-3 col-lg-3 col-xl-3 mx-auto mb-4">
                <h6 class="text-uppercase fw-bold mb-4">
                    <i class="fas fa-building me-2"></i>Sona Hotel
                </h6>
                <p>
                    Chúng tôi là khách sạn hàng đầu với dịch vụ chăm sóc khách hàng chuyên nghiệp, mang đến trải nghiệm nghỉ dưỡng tuyệt vời nhất.
                </p>
            </div>

            <!-- Dịch vụ -->
            <div class="col-md-2 col-lg-2 col-xl-2 mx-auto mb-4">
                <h6 class="text-uppercase fw-bold mb-4">
                    Dịch Vụ
                </h6>
                <p><a href="#" class="footer-link">Phòng Nghỉ</a></p>
                <p><a href="#" class="footer-link">Nhà Hàng</a></p>
                <p><a href="#" class="footer-link">Dịch Vụ Spa</a></p>
                <p><a href="#" class="footer-link">Hồ Bơi</a></p>
            </div>

            <!-- Liên kết nhanh -->
            <div class="col-md-3 col-lg-2 col-xl-2 mx-auto mb-4">
                <h6 class="text-uppercase fw-bold mb-4">
                    Liên Kết Nhanh
                </h6>
                <p><a href="#" class="footer-link">Đặt Phòng</a></p>
                <p><a href="#" class="footer-link">Về Chúng Tôi</a></p>
                <p><a href="#" class="footer-link">Điều Khoản</a></p>
                <p><a href="#" class="footer-link">Chính Sách</a></p>
            </div>

            <!-- Thông tin liên hệ -->
            <div class="col-md-4 col-lg-3 col-xl-3 mx-auto mb-md-0 mb-4">
                <h6 class="text-uppercase fw-bold mb-4">Liên Hệ</h6>
                <p><i class="fas fa-home me-3"></i> Đà Nẵng, Việt Nam</p>
                <p><i class="fas fa-envelope me-3"></i> support@sona.hotel</p>
                <p><i class="fas fa-phone me-3"></i> + 84 234 567 88</p>
                <p><i class="fas fa-print me-3"></i> + 84 234 567 89</p>
            </div>
        </div>

        <!-- Mạng xã hội -->
        <div class="d-flex justify-content-center p-4 border-top">
            <div>
                <a href="#" class="me-4 footer-link fs-4">
                    <i class="fab fa-facebook-f"></i>
                </a>
                <a href="#" class="me-4 footer-link fs-4">
                    <i class="fab fa-twitter"></i>
                </a>
                <a href="#" class="me-4 footer-link fs-4">
                    <i class="fab fa-instagram"></i>
                </a>
                <a href="#" class="me-4 footer-link fs-4">
                    <i class="fab fa-linkedin-in"></i>
                </a>
            </div>
        </div>

        <!-- Bản quyền -->
        <div class="text-center p-3 border-top">
            © 2025 Bản quyền:
            <a class="footer-link" href="#">Sona Hotel</a>
        </div>
    </div>
</footer>
</body>
<script>
    $('.slide').slick({
        slidesToShow: 1,
        slidesToScroll: 1,
        autoplay: true,
        autoplaySpeed: 1500,
    });

    function applyDiscount() {
        let selectedDiscount = document.querySelector('input[name="selectedDiscount"]:checked');

        if (!selectedDiscount) {
            alert("Please select a discount!");
            return;
        }

        let discountValueText = selectedDiscount.nextElementSibling.querySelector('.text-success').innerText;
        let discountValue = parseFloat(discountValueText.replace('% Off', '').trim());

        document.getElementById("discountValueDisplay").innerText = discountValue + "%";

        let totalPriceElement = document.getElementById("totalPriceDisplay");

        // 🔥 Lấy giá gốc từ data-original-price
        let originalPrice = parseFloat(totalPriceElement.getAttribute("data-original-price"));

        if (isNaN(originalPrice)) {
            console.error("Lỗi: Không tìm thấy giá gốc!");
            return;
        }

        // ✅ Luôn tính lại từ giá gốc
        let discountedPrice = originalPrice - (originalPrice * (discountValue / 100));
        totalPriceElement.innerText = discountedPrice.toLocaleString('en-US') + " VND";

        let modalElement = document.getElementById("discountModal");
        let modalInstance = bootstrap.Modal.getInstance(modalElement);
        document.getElementById("updatedTotalPrice").value = discountedPrice;

        if (modalInstance) {
            modalInstance.hide();
        }

        setTimeout(() => {
            document.querySelectorAll(".modal-backdrop").forEach(el => el.remove());
            document.body.classList.remove("modal-open");
            document.body.style.overflow = "auto";
            document.body.style.paddingRight = "0px";
        }, 300);
    }

    document.addEventListener("DOMContentLoaded", function() {
        let discountModal = document.getElementById("discountModal");

        discountModal.addEventListener("hidden.bs.modal", function () {
            setTimeout(() => {
                discountModal.innerHTML = discountModal.innerHTML; // Reset lại nội dung modal
                document.body.classList.remove("modal-open"); // Đảm bảo không chặn thao tác
                document.body.style.overflow = "auto"; // Cho phép cuộn lại bình thường
            }, 100);
        });
    });

    document.getElementById("paymentForm").addEventListener("submit", function (event) {
        let form = event.target;

        // Lấy giá trị checkIn, checkOut từ ngoài form
        let checkInValue = document.getElementById("checkInHidden").value;
        let checkOutValue = document.getElementById("checkOutHidden").value;

        // Nếu chưa có input, thì tạo input ẩn
        let checkInInput = document.createElement("input");
        checkInInput.type = "hidden";
        checkInInput.name = "checkIn";
        checkInInput.value = checkInValue;
        form.appendChild(checkInInput);

        let checkOutInput = document.createElement("input");
        checkOutInput.type = "hidden";
        checkOutInput.name = "checkOut";
        checkOutInput.value = checkOutValue;
        form.appendChild(checkOutInput);
    });

</script>
</html>